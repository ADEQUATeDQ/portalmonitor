<!{% extends "_base.jinja" %}
{% set active_page = "portal" -%}
    {% block sidenav %}
        <li class="active">
            <a href="/portal/{{portalID}}/info/{{snapshot}}" > <i class="fa fa-info fa-1x"></i>
                <p>Info</p>
            </a>
        </li>
        <li>
            <a href="/portal/{{portalID}}/details/{{snapshot}}"> <i class="fa fa-eye fa-1x"></i>
                <p>Details</p>
            </a>
        </li>
        <li>
            <a href="/portal/{{portalID}}/quality/{{snapshot}}"> <i class="fa fa-star-o fa-1x"></i>
                <p>Quality</p>
            </a>
        </li>
        <li>
            <a href="/portal/{{portalID}}/activity/{{snapshot}}"> <i class="fa fa-heartbeat fa-1x"></i>
                <p>Activities</p>
            </a>
        </li>
        <li>
            <a href="/portal/{{portalID}}/evolution/{{snapshot}}" class="cur"> <i class="fa fa-line-chart  fa-1x"></i>
                <p>Evolution</p>
            </a>
        </li>
    {% endblock %}



    
{% block section %}
    <div class="units-row units-split end" id="portalInfo">
        <div class="unit-70">
            <div id="selectPortal" class="dropd">
                <div class="units-row end">
                    <div class="unit-100">
                        <span id="curPortalID">{{ portalID }}</span>
                    </div>
                </div>
                <div class="units-row units-split dd">
                    <div class="input-groups filter">
                        <span class=" filter btn-append">filter:</span>
                        <input class="search">
                    </div>
                    <ul class="select"> </ul>
                </div>
            </div>
        </div>
        <div class="unit-20">
            <div id="selectSN" class="dropd">
                <div class="units-row end">
                    <div class="unit-100">
                        <span id="curSnapshot">{{ snapshot }}</span>
                    </div>
                </div>
                <div class="units-row units-split dd">
                    <div class="input-groups filter">
                        <span class="filter btn-append">filter:</span>
                        <input class="search">
                    </div>
                    <ul  class="select">    </ul>
                </div>
            </div>
        </div>
        <div class="unit-10">
            <span id="search" class="btn btn-smaller">search</span>
        </div>
    </div>

    <div class="units-row units-split end">
        <div class="unit-90 unit-push-10" id="selectAll">
            <div class="units-row">
                <div class="unit-60">
                    <div id="checkPortals" class="dropd">
                        <div class="units-row end">
                            <div class="unit-100">
                                <span>select portals</span>
                            </div>
                        </div>
                        <div class="units-row units-split dd">
                            <div class="input-groups filter">
                                <span class="filter btn-append">filter:</span>
                                <input class="search">
                            </div>
                            <ul class="select"> </ul>
                        </div>
                    </div>
                </div>
                <div class="unit-20">
                    <div id="checkISO3" class="dropd">
                        <div class="units-row end">
                            <div class="unit-100">
                                <span>select by Country</span>
                            </div>
                        </div>
                        <div class="units-row units-split dd">
                            <div class="input-groups filter">
                                <span class="filter btn-append">filter:</span>
                                <input class="search">
                            </div>
                            <ul  class="select">    </ul>
                        </div>
                    </div>

                </div>
                <div class="unit-20">
                    <div id="checkSoftware" class="dropd">
                        <div class="units-row end">
                            <div class="unit-100">
                                <span>select by Software</span>
                            </div>
                        </div>
                        <div class="units-row units-split dd">
                            <ul class="select"> </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="units-row units-split end selectedPortals">
                <div class="unit-80" id="selectedPortals">
                    <h5><span id="count"></span>Selected</h5>
                    <ul>    </ul>
                </div>
                <div class="unit-20">
                    <div id="checkSN" class="dropd">
                        <div class="units-row end">
                            <div class="unit-100">
                                <span>data_wu_ac_at</span>
                            </div>
                        </div>
                        <div class="units-row units-split dd">
                            <div class="input-groups filter">
                                <span class="filter btn-append">filter:</span>
                                <input class="search">
                            </div>
                            <ul  class="select">    </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="units-row units-split end ">
                <div class="unit-100">
                    <button class="btn btn-small right" id="go"><i class="fa fa-arrow-right fa-fw"></i>submit</button>
                </div>
            </div>
        </div>
    </div>


    <div class="units-row end" >
        <div class="unit-100">
            {% block subtitle %}{% endblock %}            
        </div>
    </div>
    
    {% block portalcontent %}
    
    {% endblock %}    
    
{% endblock %}

{% block pageScripts %}
<script>
    var data = {{ data | tojson| safe }};
    var portals = {{ portals | tojson| safe }};
    var portalID = {{ portalID | tojson | safe }}
    var snapshot = {{ snapshot | tojson | safe }}
    
    var ul= $("#selectPortal .dd ul");
    var ul1= $("#checkPortals .dd ul");
    var uliso3= $("#checkISO3 .dd ul");
    var ulsoft= $("#checkSoftware .dd ul");
    var iso3=[];
    var software=[];

    for (var item in portals){
        s = '<span class="pid ">'+item+'</span>'
        s = s+'<span class=" iso3 right"><i class="fa fa-globe fa-fw"></i>'+portals[item].iso3+'</span>'
        s = s+'<span class=" software right"><i class="fa fa-cog fa-fw"></i>'+portals[item].software+'</span>'

        if ($.inArray(portals[item].iso3, iso3) ==-1){
            iso3.push(portals[item].iso3)
            uliso3.append('<li><input type="checkbox" value="'+portals[item].iso3+'"><label>'+portals[item].iso3+'</label></li>')
        }
        if ($.inArray(portals[item].software, software) ==-1){
            software.push(portals[item].software)
            ulsoft.append('<li><input type="checkbox" value="'+portals[item].software+'"><label>'+portals[item].software+'</label></li>')
        }
        ul.append('<li><a href="/portal/'+item+'/info/'+snapshot+'">'+s+'</a></li>')
        ul1.append('<li><input type="checkbox" value="'+item+'"><label>'+s+'</label></li>')
    }
    
    var ul= $("#selectSN .dd ul")
    $.each(data.portalSnapshots[portalID], function(idx, v){
        ul.append('<li><a href="/portal/'+portalID+'/info/'+v+'">'+v+'</a></li>')
    })
    
    var dd = new DropDown($('#selectPortal'));
    var df = new DropDown($('#selectSN'));
    var cportals = new DropDown($('#checkPortals'));
    var ciso3 = new DropDown($('#checkISO3'));
    var csoft = new DropDown($('#checkSoftware'));
    var csn = new DropDown($('#checkSN'));

    var selectPortalUL=$("#selectedPortals ul")

    function updateCount(){
        var c=0
        $("#selectedPortals ul li").each(function(){
            c++
        })
        $("span#count").text(c)
    }

    $("#checkPortals .dd ul> li input").change(function(){
        pid=$(this).val()
        if($(this).is(":checked")) {
            
            s = '<li><label><span class="pid">'+item+'</span>'
            s = s+'<span class="iso3">'+portals[item].iso3+'</span>'
            s = s+'<span class="software">'+portals[item].software+'</span></label></li>'
            $("#selectedPortals ul").append(s)
        }else{
            $("#selectedPortals ul li").each(function(){
                if ($(this).find("span.pid").text() == pid){
                    $(this).remove()
                }
            })
        }
        updateCount()
    })
    $("#checkISO3 .dd ul> li input").change(function(){
        iso3=$(this).val()
        console.log(iso3)
        if($(this).is(":checked")) {
            for (var item in portals){
                if (portals[item].iso3==iso3){
                    s = '<li><label><span class="pid">'+item+'</span>'
                    s = s+'<span class="iso3">'+portals[item].iso3+'</span>'
                    s = s+'<span class="software">'+portals[item].software+'</span></label></li>'
                    selectPortalUL.append(s)
                }
            }
        }else{
            $("#selectedPortals ul li").each(function(){
                if ($(this).find("span.iso3").text() == iso3){
                    $(this).remove()
                }
            })
        }
        updateCount()
        
    })
    $("#checkSoftware .dd ul> li input").change(function(){
        soft=$(this).val()
        if($(this).is(":checked")) {
            for (var i in portals){
                if (portals[i].software==soft){
                    s = '<li><label><span class="pid">'+i+'</span>'
                    s = s+'<span class="iso3">'+portals[i].iso3+'</span>'
                    s = s+'<span class="software">'+portals[i].software+'</span></label></li>'
                    
                    selectPortalUL.append(s)
                }
            }
        }else{
            $("#selectedPortals ul li").each(function(){
                if ($(this).find("span.software").text() == soft){
                    $(this).remove()
                }
            })
        }
        
        updateCount()
    })
    $("#selectAll").hide()
    $("#search").click(function () {
            // all dropdowns
            $("#selectAll").toggle()

    });
    
    $("#go").click(function () {
        window.location = "/portals/info/1534?iso3=AUT";
        
    })
    
    $(document).click(function () {
        $('.dd').hide()
    });
    
        {% block portalScripts %}
    
    {% endblock %}  

</script>
{% endblock %}
