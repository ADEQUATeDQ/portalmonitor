<!{% extends "_base.jinja" %}

{% block sidenav %}
            <li class=" text-centered">
                        <a href="/"> 
                            <i class="fa fa-server fa-fw"></i>
                            <p>System</p>
                        </a>
                    </li>
                    <li class=" text-centered">
                        <a href="/portals"> 
                            <i class="fa fa-cubes  fa-fw"></i>
                            <p>Portals</p>
                        </a>
                    </li>
                    <li class="active text-centered">
                        <a href="/activity">
                            <i class="fa fa-cubes  fa-fw"></i>
                            <p>Activity</p>
                        </a>
                    </li>
{% endblock %}
{% block section %}
    <div class="units-row">
        <h2>Portal Watch Activity for snapshot {{snapshot}}</h2>
    </div>
    <div class="units-row">
                <div class="unit-33 card unit-padding">
                    <div class="card_header"><h3 class="text-centered">Fetch Process</h3></div>
                    <div class="card_cnt">
                        <ul class="fa-ul">
                            <li class="group">
                                <i class="fa fa-check-square-o fa-fw"></i>
                                <button id="btn_fetch_done" class="btn label label-green width-60">Processed</button>
                                <span id="fetch_done" class=" label label-green width-20 text-right"></span>
                            </li>
                            <li class="group">
                                <i class="fa fa-spinner fa-spin fa-fw"></i>
                                <button id="btn_fetch_running" class="btn label label-blue width-60">Running</button>
                                <span id="fetch_running" class="label label-blue width-20 text-right"></span>

                            </li>
                            <li class="group"><i class="fa fa-exclamation-triangle fa-fw"></i>
                                <button id="btn_fetch_failed" class="btn label label-red  width-60">Failed</button>
                                <span id="fetch_failed" class="label label-red width-20 text-right"></span>

                            </li>
                            <li class="group"><i class="fa fa-question-circle fa-fw"></i>
                                <button id="btn_fetch_mis" class="btn label  width-60">Missing</button>
                                <span id="fetch_missing" class="label width-20 text-right"></span>

                            </li>
                            
                        </ul>
                    </div>
                    <div class="card_footer">
                    <span class="label label-white width-100">{{data.dbds}} datasets inserted</span>
                    </div>
                </div>
                <div class="unit-33 card unit-padding">
                    <div class="card_header"><h3 class="text-centered">Head Lookups</h3></div>
                    <div class="card_cnt">
                        <ul class="fa-ul">
                            <li class="group">
                                <i class="fa fa-check-square-o fa-fw"></i>
                                <button id="btn_fetch_done" class="btn label label-green width-60">Processed</button>
                                <span id="fetch_done" class=" label label-white width-20 text-right"></span>
                            </li>
                            <li class="group">
                                <i class="fa fa-spinner fa-spin fa-fw"></i>
                                <button id="btn_fetch_running" class="btn label label-blue width-60">Running</button>
                                <span id="fetch_running" class="label label-white width-20 text-right"></span>

                            </li>
                            <li class="group"><i class="fa fa-exclamation-triangle fa-fw"></i>
                                <button id="btn_fetch_failed" class="btn label label-red  width-60">Failed</button>
                                <span id="fetch_failed" class="label label-white width-20 text-right"></span>

                            </li>
                            <li class="group"><i class="fa fa-question-circle fa-fw"></i>
                                <button id="btn_fetch_mis" class="btn label  width-60">Missing</button>
                                <span id="fetch_mis" class="label label-white width-20 text-right"></span>

                            </li>
                        </ul>
                    </div>
                    <div class="card_footer">
                        <span class="label label-white width-100">{{data.dbres}} resources</span>
                    </div>
                </div>
                <div class="unit-30  card unit-padding">
                    <div class="card_header"><h3 class="text-centered">Quality Assessment</h3></div>
                    <div class="card_cnt">
                        <ul class="fa-ul">
                            <li class="group">
                                <i class="fa fa-check-square-o fa-fw"></i>
                                <button id="btn_fetch_done" class="btn label label-green width-60">Processed</button>
                                <span id="fetch_done" class=" label label-white width-20 text-right"></span>
                            </li>
                            <li class="group">
                                <i class="fa fa-spinner fa-spin fa-fw"></i>
                                <button id="btn_fetch_running" class="btn label label-blue width-60">Running</button>
                                <span id="fetch_running" class="label label-white width-20 text-right"></span>

                            </li>
                            <li class="group"><i class="fa fa-exclamation-triangle fa-fw"></i>
                                <button id="btn_fetch_failed" class="btn label label-red  width-60">Failed</button>
                                <span id="fetch_failed" class="label label-white width-20 text-right"></span>

                            </li>
                            <li class="group"><i class="fa fa-question-circle fa-fw"></i>
                                <button id="btn_fetch_mis" class="btn label  width-60">Missing</button>
                                <span id="fetch_mis" class="label label-white width-20 text-right"></span>

                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="units-row">
                <div class="unit-100 unit-padding card">
                    <div class="card_header">Portals</div>
                    <div class="cnt">
                        <button id="btn_all" class="btn btn-smaller"><i class="fa fa-pie-chart fa-fw"></i>Show full table</button>
                        <div class="data_table">
                            <table id="sysacttable">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th colspan="6">Fetching</th>
                                        <th colspan="2">Head</th>
                                        <th>Quality</th>
                                    </tr>
                                    <tr>
                                        <th>Portal</th>
                                        <th>Running</th>
                                        <th>Done</th>
                                        <th>Failed</th>
                                        <th>Error</th>
                                        <th>start</th>
                                        <th>end</th>
                                        <th>Done</th>
                                        <th>Missing</th>
                                        <th>Done</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                    <div class="card_footer">

                    </div>
                </div>
            </div>          

 
                 
      
{% endblock %}

{% block pageScripts %}
 <script>
     
     
     var data = {{ data | tojson|safe }};
     console.log("SERVER DATA")
     console.log(data)
     
     function resetTable(table){
         table.search( '' )
            .columns().search( '' )
            .draw();
     }
     
     function showRows(table, colID, show){
         resetTable(table)
        table.column(colID).search('true').draw()
        table.columns( ).visible( false );
        table.columns( show ).visible( true );
        
     }
     
 $(document).ready(function() {
     var t_sysacttable=$('#sysacttable').DataTable();
     data.portalactivitylist.forEach(function(item){
        t_sysacttable.row.add([item.pid, 
                               item.fetch_running, 
                               item.fetch_done, 
                               item.fetch_failed, 
                               item.fetch_error, 
                               item.fetch_start, 
                               item.fetch_end,
                               item.head_done,
                               item.head_missing, 
                               item.quality_done]);
    }); 
     t_sysacttable.draw();
    $('#btn_fetch_done').click(function() {
         showRows(t_sysacttable, 2, [0,6])
    }); 
    $('#btn_fetch_running').click(function() {
        showRows(t_sysacttable, 1, [0,5])
    });
    $('#btn_fetch_failed').click(function() {
         showRows(t_sysacttable, 3, [0,4])
    });
     
      $('#btn_all').click(function() {
        resetTable(t_sysacttable)
        t_sysacttable.columns().visible( true );
      })
     
     
     for( var k in data.portalactivitysummary){
         console.log(k)
         console.log(data.portalactivitysummary[k])
         $('#'+k).text(data.portalactivitysummary[k])
     }
})
    
 </script>
{% endblock %}