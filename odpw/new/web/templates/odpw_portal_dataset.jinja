{% extends "odpw_portal_layout.jinja" %}

{% set active_sub_page = "ui.portalDataset" -%}

{% block headcss %}
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.12/css/dataTables.semanticui.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.2.1/css/buttons.semanticui.min.css">
{% endblock %}
{% block headscripts %}
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.js"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
{% endblock %}

{% macro distTable(data, key, label) -%}
<table class="ui celled table" id="table{{label}}" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>{{label}}</th>
            <th>count</th>
            <th>percentage</th>
        </tr>
    </thead>
    <tfoot>
        <tr>
            <th>{{label}}</th>
            <th>count</th>
            <th>percentage</th>
        </tr>
    </tfoot>
    <tbody>
        {% for l in data[key].top3Dist %}
        <tr>
            <td class="hideextra">{{l[key]}}</td>
            <td>{{l.count}}</td>
             <td>({{ (l.perc*100)| round(2)}}%)</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{%- endmacro %}


{% block portalcontent %}
    <h3 class="ui header"> Portal: {{portalid}}

                    <div class="ui left pointing scrolling dropdown icon">
                        <i class="dropdown icon"></i>
                        <div class="menu">
                            <div class="ui left search icon input">
                                <i class="search icon"></i>
                                <input type="text" name="search" placeholder="Search datasets...">
                            </div>
                            <div class="header">
                                <i class="tags icon"></i>
                                Portals
                            </div>
                            {% for dataset in data.datasets%}
                            <div  class="item">
                                <a href="{{url_for(active_sub_page, portalid=portalid, snapshot=snapshot, dataset=dataset.id)}}">
                                    {{dataset.id}}
                                </a>
                            </div>
                            {% endfor %}

                        </div>
                    </div>

                </h3>

    {% if data.datasetData %}
    <div class="ui vertical segment">
        <div class="ui two column padded very relaxed grid">
            <div class="column">
                <h3 class="ui header"> Raw JSON metadata</h3>
                <pre  class="prettyprint" id="json" style="height: 400px"></pre>
            </div>
            <div class="ui vertical divider">

            </div>
            <div class="column">
                <h2 class="ui header"> Quality assessment</h2>

                {% for k in qa %}
                    <div class="ui horizontal divider">{{k.dimension}} Metrics</div>
                    <div class="ui three column padded grid">

                    {% for kk,d in k.metrics.iteritems() %}

                        {% set m = kk| lower -%}
                        <div class="  column">
                            <div class="ui label" style="color:{{d.color}}"">{{d.label}}
                                <div class="detail">{{ data.datasetData[m]}}</div>
                            </div>
                        </div>



                    {% endfor %}
                    </div>
                {% endfor %}
            </div>

        </div>
    </div>
    {% endif %}

{% endblock %}

{% block script %}
    {{ super() }}

    data={{ data.json|tojson }}
    document.getElementById("json").innerHTML = JSON.stringify(data, undefined, 2);

     $(document).ready(function() {

        $('#tabs .item')
         .tab()
        ;
        $('#tableFormat').DataTable(
        {
            dom: 'lfrBtip',
            lengthChange: false,
            scrollX: true
        });
        $('#tableOrganisation').DataTable(
        {
            dom: 'lfrBtip',
            lengthChange: false,
            scrollX: true
        });

        $('#tableLicense').DataTable(
        {
            dom: 'lfrBtip',
            lengthChange: false,
            scrollX: true
        });


    })
 {% endblock %}